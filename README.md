# Лабораторная работа N2  
--  
### Условие  
**Создать файл sh и bat, который выполняет следующее:**  
На вход пакетному файлу приходит значение PID (число) процесса (как параметр пакетного файла). Если процесс запущен, то вывести информацию о нем. Далее вывести сообщение, “Хотите завершить процесс? [Y/n]”, если после этого пользователь ввел Y, то процесс должен быть завершен с сообщением в консоль “Процесс завершен”, если пользователь выбрал n, то программа заканчивается, если пользователь ввел что-то другое, то повторно задать вопрос.  


## Файл .bat  
*Код:*  
```bat  
@echo off  
chcp 65001 > NUL  
set /p x="Введите PID"  
tasklist /fi "pid eq %x%"  
tasklist>newfile.txt  
FINDSTR %x% newfile.txt   
if errorlevel 1 goto b  
del newfile.txt  
:A  
set /p a=“Хотите завершить процесс? [Y/n]”  
IF %a%==y taskkill /fi "pid eq %x%"  
IF %a%==y echo процесс завершен  
IF %a%==y TIMEOUT /T 10  
IF %a%==y EXIT /B 0  
IF %a%==n echo процесс не будет завершен  
IF %a%==n TIMEOUT /T 10  
IF %a%==n EXIT /B 0  
goto a  
:b  
echo Процесс не найден   
TIMEOUT /T 10  
EXIT /B 0  
```  
**Переменные:**  
* x-число,которое вводит пользователь,содержит PID процесса,с которым хочет взаймодействовать пользователь.  
* a-символ,который вводит пользователь.Если пользователь хочет завершить процесс,то он вводит y,если пользователь не хочет завершать процесс,то он вводит n.В любом другом случае пользователь должен еще раз ввести символ.  
'set /p x="Введите PID"'-строчка,которая выводить сообщение "Введите PID" и дает пользователю ввести значение переменной x  
'tasklist /fi "pid eq %x%"'-строчка,которая ввыдит информацию о процессе с заданным PID  
'tasklist>newfile.txt':создается файл и в него вносится информация о всеx процессах  
```bat  
if errorlevel 1 goto b  
...  
:b  
echo Процесс не найден  
del newfile.txt  
TIMEOUT /T 10  
EXIT /B 0  
```  
Эта часть кода делает так,чтобы,если пользователь ввел PID,которое не соответствует никакому процессу,ему выводилось сообщение "Процесс не найден" и выполнение .bat файла заканчивалось.  
![Пример](/images/notfindbat.png)  
Проверяется есть ли процесс с заданным PID следующим образом:  
1. Команда 'FINDSTR %x% newfile.txt' проверяет, есть ли в тескстовом файле newfile.txt PID соответствующее введенному пользователем.Если его нет 'errorlevel' повышается с 0 до 1.  
2. 'if errorlevel 1 goto b':если 'errorlevel'=1 код начинает выполняться с момента b: игнорируя все что было до него.  
3. 'echo Процесс не найден ':на экран выводится сообщение "Процесс не найден"  
4. 'TIMEOUT /T 10': таймер на 10 секунд  
5. 'EXIT /B 0': выполнения bat.файла заканчивается.  
'set /p a=“Хотите завершить процесс? [Y/n]”:команда,которая выводить сообщение "Хотите завершить процесс? [Y/n]" и дает пользователю ввести значение переменной a  
Если пользователь вводит любой символ кроме y и n c помощью команды goto возвращается ему снова предлагается ввести переменную a.  
![Пример](/images/proverkabat.png)  
--  
```bat  
IF %a%==y taskkill /fi "pid eq %x%"  
IF %a%==y echo процесс завершен  
IF %a%==y TIMEOUT /T 10  
IF %a%==y EXIT /B 0  
```  
Эта часть кода отвечает за завершение процесса с заданным пользователем PID,если пользователь ввел y.Процесс завершает команда 'IF %a%==y taskkill /fi "pid eq %x%"'  
![Пример](/images/ychbat.png)  
--  
```bat  
IF %a%==n echo процесс не будет завершен  
IF %a%==n TIMEOUT /T 10  
IF %a%==n EXIT /B 0 
```  
Это часть кода отвечает за завершение выполнения bat-файла если пользователь ввел n.  
![Пример](/images/nchbat.png)  
  
## Файл.sh
*Код:*    
```bash  
#! /bin/bash  
touch text.txt   
ps>text.txt  
echo Введите PID процесса  
read pid  
var=0  
t=1  
x=0  
if [ $(grep -ic $pid text.txt) -eq $t ]; then   
	var=1  
fi  
rm text.txt  
  
if [ "$var" = "$x" ]; then  
	echo Такого процесса нет  
	sleep 5  
	exit 0  
fi  
  
ps -fp [$pid]  
echo Хотите закончить процесс [y/n]  
read sim  
  
while [ "$sim" != "y" ] && [ "$sim" != "n" ]; do  
	echo Хотите закончить процесс [y/n]  
	read sim  
	done  
if [ "$sim" == "y" ]; then  
	echo Процесс будет завершен  
	sleep 5  
	kill $pid  
	exit 0  
fi  
if [ "$sim" == "n" ]; then  
	echo Процесс не будет завершен  
	sleep 5  
	exit 0  
fi  
```  
**Переменные:**  
* pid-число,которое вводит пользователь,содержит PID процесса,с которым хочет взаймодействовать пользователь.  
* sim-символ,который вводит пользователь.Если пользователь хочет завершить процесс,то он вводит y,если пользователь не хочет завершать процесс,то он вводит n.В любом другом случае пользователь должен еще раз ввести символ.  
* var-переменная,чье значение зависит от того,существет ли процесс с заданным пользователем PID.  
* x-переменная,равная 0.Используется в ветвлении if.  
* t-переменная,равная 1.Используется в ветвлении if.  
Строка 'touch text.txt' создает текстовый файл text.txt.    
Строка 'ps>text.txt' вносит информацию о всех процессах,запущенных на компьютере в текстовый файл text.txt  
Строка 'echo Введите PID процесса' выводит на экран ссобщение 'Введите пид процесса'  
Строка 'read pid' позволяет пользователю ввести значение,которое присваевается переменной pid.  
--  
```bash  
var=0  
t=1  
x=0  
```  
В этой части кода мы вводим переменные var,t и x и присваеваем им значения.  
--  
```bash  
if [ $(grep -ic $pid text.txt) -eq $t ]; then  
	var=1  
fi  
```  
В этой части кода проверяется есть ли процесс с заданным PID в text.txt.Если такой процесс есть переменной var присваевается значение 1.  
--  
строка 'rm text.txt' удаляет файл text.txt  
--  
Если переменная var равна 0 то выполнение .sh файла прекрашается.  
Это проверяется в следующих строках кода:  
```bash  
	echo Такого процесса нет  
	sleep 5  
	exit 0  
```  
Команда 'sleep 5' делает так,чтобы следующая строка кода выполнялась через 5 секунд  
![Пример](/images/notfindsh.png)  
--  
Строка 'ps -fp [$pid]' выврдит информацию о процессе с заданным PID.  
Строка 'echo Хотите закончить процесс [y/n]' выводит на экран ссобщение 'Хотите закончить процесс [y/n]'  
Строка 'read sim' позволяет пользователю ввести символ,которой присваевается переменной sim.  
--  
```bash  
while [ "$sim" != "y" ] && [ "$sim" != "n" ]; do   
	echo Хотите закончить процесс [y/n]  
	read sim  
	done  
```  
Это часть кода проверяет,чтобы введенный символ был или y или n.В любом другом случае пользователя еще раз просят ввести символ.  
![Пример](/images/proverkash.png)  
--  
```bash  
if [ "$sim" == "y" ]; then  
	echo Процесс будет завершен  
	sleep 5  
	kill $pid  
	exit 0  
fi  
```  
Эта часть кода отвечает за завершение процесса,если пользователь ввел y.Строка 'kil $pid' завершает процесс с заданным пользователем PID.  
![Пример](/images/ychsh.png)  
--  
```bash  
if [ "$sim" == "y" ]; then  
	echo Процесс будет завершен  
	sleep 5  
	kill $pid  
	exit 0  
fi  
```  
Эта часть кода отвечает за завершения выполнения .sh файла,если пользователь ввел n.  
![Пример](/images/nchsh.png)  


