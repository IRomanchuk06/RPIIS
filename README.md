# Лабораторная работа №1

## Вариант 35
Условие:
> На вход пакетному файлу приходит путь к каталогу (как параметр пакетного файла). Если такой папки нет, то писать “Данной папки нет” и завершить выполнение программы. Если такая папка есть, то найти в заданном каталоге и всех его подкаталогах все файлы заданного размера и принадлежащие определённому пользователю. Диапазон (min - max) размеров файлов задаётся пользователем в качестве второго и третьего параметра пакетного файла. Имя владельца задаётся пользователем в качестве четвёртого параметра пакетного файла. Скрипт выводит результаты поиска в файл в виде "полный путь, имя файла, его размер", в конец файла выводится общее число просмотренных файлов

## Параметры запуска
1. Путь к папке, с которой будет вестись работа.
2. Минимально допустимый размер файла в папке.
3. Максимально допустимый размер файла в папке.
4. Какой должен быть у файла владелец.

## Словесное описание алгоритма
1. Пользователь одновременно с запуском скрипта вводит 4 указанных выше параметра.
2. Проверка на существование папки, указанной в первом параметре.
   - Если папка не существует, программа завершает свою работу.
3. Проход по папке и её подпапкам.
4. Вывод полного и краткого имени, а также размера тех файлов в папке и её подпапках, которые удовлетворяют следующим условиям:
   - Размер находится в диапазоне, заданном во втором и третьем параметрах;
   - Владелец файла совпадает с указанным в четвёртом параметре.

## Полный код скрипта
CMD:
```batchfile
@echo off
chcp 65001 >nul
setlocal EnableDelayedExpansion

if not exist %1%\ (
echo Данной папки нет
pause

) else (

for /f "delims=" %%i in ('dir /a-d/b/s %1') do (

PowerShell.Exe -executionpolicy bypass -File "findowner.ps1" "%%i" >op.tmp
set /p owner=<op.tmp
del op.tmp

if %%~zi leq %3 if %%~zi geq %2 if "!owner!" equ "%4" echo %%i %%~nxi %%~zi>con)

set ff=0 & for /f "delims=" %%i in ('dir /a-d/b/s %1') do @(set /a ff+=1 >nul)

echo Всего файлов прочитано: !ff! && set "ff="
pause
)
```
		
Вспомогательный алгоритм findowner.ps1:
```powershell
param ($thefile)
(Get-Acl $thefile).Owner
```


Shell:
```shell
#!bin/bash

if ! test -d "$1"
then
	echo Данной папки нет

else
	count=0
			
	if test -d $1/**/
	then
		for file in $1/*.* $1/**/*.*
		do
			let count=count+1
			
			fsize=`cat $file | wc -c`
			fuser=`stat --format '%U' $file`
					
			if [[ $fsize -le $3 && $fsize -ge $2 && $4=$fuser ]]
			then
				echo $file `basename $file` $fsize
			fi
		done
	
	else
		for file in $1/*.*
		do
			let count=count+1
			
			fsize=`cat $file | wc -c`
			fuser=`stat --format '%U' $file`
			
			if [[ $fsize -le $3 && $fsize -ge $2 && "$4"="$fuser" ]]
			then
				echo $file `basename $file` $fsize
			fi
		done
	fi
			
	echo Всего файлов прочитано: $count
fi
```

## Подробное описание кода
### CMD
```batchfile
@echo off
```
\- отключение отображения выполняемых команд на экране.
```batchfile
chcp 65001 >nul
```
\- перевод рабочей кодовой страницы на UTF-8.
```batchfile
setlocal EnableDelayedExpansion
```
\- переменные будут обрабатываться по мере выполнения скрипта, что обеспечит корректную работу с ними.
```batchfile
if not exist %1%\ (
echo Данной папки нет
pause
)
```
\- если папки, указанной в первом параметре, не существует, скрипт выводит "Данной папки нет" и ожидает нажатия клавиши пользователем перед своим закрытием.

## Пример запуска
Дана следующая папка:

![Изображение папки](img/test_folder.png)
![Изображение подпапки](img/test_subfolder.png)

Запуск команды с путём к этой папке в качестве параметра:

![Изображение команды (bat)](img/test_command_bat.png)

![Изображение команды (sh)](img/test_command_sh.png)
