# Лабораторная работа 2
## Цель лабораторной работы №1

- Ознакомиться с командной строкой операционных систем _Windows_ и _Linux_.
- Создать исполняемые файлы _.bat_ и _.sh_ в соответствии с заданными правилами.

## Условие лабораторной работы №1. Вариант 6.

```
6.Создать файл sh и bat, который выполняет следующее:
На вход пакетному файлу приходит два числа (X и N) и абсолютный путь к папке (как параметры пакетного файла).
Каждые X секунд в заданной папке удалять N первых файлов (по алфавиту).
Скрипт должен должен работать, пока не останется менее N файлов.
```
## Описание алгоритма. Пример запуска и выполнения программы.(.bat)

![image1](pictures/bat.png)

### Алгоритм программы

1. Установливаем опцию `enabledelayedexpansion` для включения режима отложенного разрешения переменных
   ```
   setlocal enabledelayedexpansion
   ```
2. Присваиваем (команда `set`) переменным `X` `N` `directory` значения, вводимые с клавиатуры, и переменной `q` значение 0
   ```
   set /A "X=%~1"
   set "N=%~2"
   set "directory=%~3"
   set "q=0"
   ```
3. Считаем количество файлов в папке `directory`
    
   3.1 Присваиваем счетчику `number` значение 0
   ```
   set /A number=0
   ```
   3.2 Находим файлы (команда `for /R`) в папке `directory`с любым названием и любым расширением `(*.*)`
   ```
   for /R "%directory%" %%I in (*.*) do (
   ...
   )
   ```
   3.3 Присваиваем счетчику `number` число, на 1 больше, чем оно само
   ```
   set /A number+=1
   ```
4. Проверяем (команда `if`), равно или больше количество файлов `numder` папки заданному параметру `N`, если да, то переходим в пункт 5 (команда `goto`), если нет, то переходим в пункт 7
```
if !number! geq %N% (
    goto :out
) else (
    goto :end
)
```
5. Удаляем файлы
   
   5.1 Передаем все файлы (команда `dir`) в папке `directory` команде `for /R`
   ```
   dir "%directory%" /b /on
   ```   
   5.2 Находим файлы с любым названием и любым расширением
   ```
   for /R "%directory%" %%E in (*.*) do (
   ...
   )
   ```
   5.3 Присваиваем переменнй `file` файл `E`, который был выбран командой `for /R`
   ```
   set "file=%%E"
   ```
   5.4 Проверяем, сколько файлов удалили
   
       5.4.1 Если счетчик `q` меньше, чем `N`, то переходим к пункту 5.4.2, если нет, то переходим к пункту 6
       ```
       if !q! LSS %N% (
       ...
       ) else (
        goto :w
       )
       ```
       5.4.2 Присваиваем счетчику `q` число, на 1 больше, чем оно само
       ```
       set /A "q+=1"
       ```
       5.4.3 Удаляем файл (команда `del /Q`)
       ```
       del /Q "!file!"
       ```
       5.5 Переходим к пункту 5.1
       ```
       goto :out
       ```
7. Проверка после удаления файлов
   
   6.1 Присваиваем счетчику `q` значение 0
   ```
   set "q=0"
   ```
   6.2 Присваиваем счетчику `number` значение 0
   ```
   set /A number=0
   ```
   6.3 Считаем количество файлов в папке `directory`
   
       6.3.1 Находим файлы с любым названием и любым расширением
       ```
       for /R "%directory%" %%I in (*.*) do (
       ...
       )
       ```
       6.3.2 Присваиваем счетчику `number` число, на 1 больше, чем оно само
       ```
       set /A number+=1
       ```
   6.4 Проверяем, равно или больше количество файлов `number` папки заданному параметру `N`, если да, то переходим в пункт 6.5, если нет, то переходим в пункт 7
   ```
   if !number! geq %N% (
    ...
    ) else (
    goto :end
    )
   ```
   6.5 Ждем (команда `timeout /T`) `X` секунд
   ```
   timeout /T %X%
   ```
9. Завершаем работу алгоритма

## Пример работы программы

Вводим через командную строку _Windows_ данный код:
```
C:\Users\Asus> 1lab.bat 5 5 "C:\Users\Asus\Desktop\Lab1"
```
Что мы имели до:

![image2](pictures/Dirbef.png)

Что мы имеем после:

![image3](pictures/Diraft.png)

## Описание алгоритма. Пример запуска и выполнения программы.(.sh)

![image1](pictures/sh.png)

### Алгоритм программы

1. Инициализируем возможность использования библиотеки команд `bash`
    ```
    #!/bin/bash
    ```
2. Присваиваем переменным `X` `N` `directory` значения, вводимые с клавиатуры, и переменной `q` значение 0
   ```
   directory="$1"
   N="$2"
   X="$3"
   q=0
   ```
3. Дикларируем функцию вывода (функция `end()`)
   ```
   end() {
   echo "end"
   exit 0
   }
   ```
4. Дикларируем функцию удаления файлов (функция `out()`)
   ```
   out() {
   ls -l "$directory"
   for file in "$directory"/*; do
     if [ "$q" -lt "$N" ]; then
        ((q++))
        rm -f "$file"
        out
     else
        w
     fi
   done
   }
   ```
5. Дикларирем функцию проверки выполнения функции `out()` и режима сна (функция `w()`)
   ```
   w() {
      q=0
      number=0
      for file in "$directory"/*; do
        if [ -f "$file" ]; do
        ((numder++))
        fi
      done

      if [ "$number" -ge "$N" ]; then
         sleep "X"
         out
      else
         end
      fi
   }
   ```
6. Присваиваем переменной `number` значение 0
   ```
   number=0
   ```
7. Считаем количество файлов (переменная `number`) в папке `directory`
   ```
   for file in "$directory"/*; do
        if [ -f "$file" ]; do
        ((numder++))
        fi
      done
   ```
8. Если количество файлов `number` больше, чем `N` переходм в пункт 4, если нет - переходим в пункт 3
   ```
   if [ "$number" -ge "$N" ]; then
      sleep "X"
      out
   else
      end
   fi
   ```
## Пример работы программы
Что мы имели до:

![image1](pictures/Dirbef_sh.png)

Что мы имеем после:

![image3](pictures/Diraft_sh.png)

# Вывод
В ходе выполнения Лабораторной работы №1 были применены навыки работы с командной строкой в операционных системах Windows и Linux. Также разработал программы, которые реализовывали алгоритмы, соответствующие заданным условиям.
