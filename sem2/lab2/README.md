# Лабораторная работа №2

## Вариант 9

Условие:
> Реализовать программу, определяющую, является ли одно, либо оба из двух исходных множеств подмножеством или элементом другого.

**Тема** - множества.

**Цель лабораторной работы** - разработка библиотеки для работы с множествами в соответствии с условием и проверка её на работоспособность.

**Задача лабораторной работы** - научиться работать с классами (в данном случае - при помощи Python).

## Определения, используемые при выполнении лабораторной работы

**Множество** - набор, совокупность каких-либо объектов, или элементов этого множества. Элементами множества могут быть в т.ч. и другие множества.

**Подмножество** множества A - множество B такое, что все его элементы принадлежат также и множеству A.

## Полный код

Модуль *buraksets.py*:
```python
def hasCorrectFormat1(string):
    string = string.strip()
    string = string.replace(' ', '')
    
    if string == '{}' or string == '':
        return False
    
    if string[0] != '{' or string[-1] != '}':
        return False
    
    string = string[1:-1]
    
    if string[-1] == ',' or string[0] == ',':
        return False
    
    try:
        list1 = string.split(',')
    except:
        return False
    else:
        open_br = False
        for i in range(len(string)):
            if i != len(string)-1 and string[i].isalpha() and string[i+1].isalpha():
                return False
            if not string[i].isalpha() and not string[i] in ['{','}',',']:
                return False
            
            if string[i] == '{' and not open_br:
                open_br = True
            elif string[i] == '{' and open_br:
                return False
            elif string[i] == '}' and open_br:
                open_br = False
            elif string[i] == '}' and not open_br:
                return False
            elif open_br and i == len(string)-1:
                return False
        return True

def hasCorrectFormat2(set1):
    if len(set1) > 1:
        if ('' in set1) or ('{' in set1) or ('}' in set1):
            return False
    return True

def strToSet(string):
    if not hasCorrectFormat1(string):
        return 'Error'
    
    string = string.strip()
    string = string.replace(' ',''
    string = string[1:-1]
    list1 = string.split(',')
    
    list2 = []
    in_set = False
    for i in list1:
        is_long = (len(i)>=2)
        if is_long and i[0]=='{' and i[-1]=='}':
            list2.append(i)
        elif is_long and i[0]=='{':
            a = i
            in_set = True
        elif is_long and in_set and i[-1]=='}':
            in_set = False
            list2.append(a + ',' + i)
        elif in_set:
            a += ','
            a += i
        else:
            list2.append(i)
            
    if not hasCorrectFormat2(list2):
        return 'Error'
    
    for i in range(len(list2)):
        if hasCorrectFormat1(list2[i]):
            p = strToSet(list2[i])
            if p != 'Error':
                list2[i] = Mnozh.setToStr(p)
            else:
                return 'Error'
    return sorted(set(list2))



class Mnozh:
    def setToStr(sett):
        string = '{'
        string += ','.join(sett)
        string += '}'
        return string
    def isSubset(a,sett):
        c = strToSet(Mnozh.setToStr(a))
        d = strToSet(Mnozh.setToStr(sett))
        if c != 'Error' and d != 'Error':
            for element in c:
                if element not in d:
                    return False
            return True
        else:
            return 'Error'
    def isElement(a,sett):
        c = strToSet(Mnozh.setToStr(a))
        d = strToSet(Mnozh.setToStr(sett))
        if c != 'Error' and d != 'Error':
            return (Mnozh.setToStr(c) in d)
        else:
            return 'Error'
    

```

Основная программа *burakl2*:
```python
from buraksets import Mnozh, strToSet

infile = input('Из какого файла вы хотите прочитать множества? ')

try:
    file = open(infile, mode='r', encoding='utf-8')
except:
    print('Ошибка при чтении файла!')
else:
    string1 = file.readline()
    string2 = file.readline()

    set1 = strToSet(string1)
    set2 = strToSet(string2)

    print()

    if set1 == 'Error' and set2 == 'Error':
        print('Ошибка при чтении обоих множеств!')
        
    elif set1 == 'Error':
        print('Ошибка при чтении первого множества!')
        
    elif set2 == 'Error':
        print('Ошибка при чтении второго множества!')
        
    else:
        print('Первое множество:', Mnozh.setToStr(set1))
        print('Второе множество:', Mnozh.setToStr(set2))
        
        print()
        
        print('Первое множество -',end=' ')
        if not Mnozh.isElement(set1, set2):
            print('не', end=' ')
        print('элемент второго.')
        
        print('Второе множество -', end=' ')
        if not Mnozh.isElement(set2, set1):
            print('не',end=' ')
        print('элемент первого.')
        
        print('Первое множество -',end=' ')
        if not Mnozh.isSubset(set1, set2):
            print('не', end=' ')
        print('подмножество второго.')
        
        print('Второе множество -',end=' ')
        if not Mnozh.isSubset(set2, set1):
            print('не', end=' ')
        print('подмножество первого.')

    file.close()
```

## Описание кода модуля *buraksets.py*

Функции в модуле:
<details>
<summary> *hasCorrectFormat1* - определение корректности заданной строки с множеством. </summary>
	
	Функция возвращает False, если: строка пуста; не ограничена с обоих боков фигурными скобками; часть внутри фигурных скобок начинается или заканчивается запятой; происходит ошибка при разбиении строки по запятым; в строке встречается более одной буквы подряд; в ней есть какие-либо символы, кроме фигурных скобок, запятых и букв; в строке записано более одного вложенного множества; встречается закрывающая фигурная скобка без предшествующей ей открывающей; открытая фигурная скобка так и не закрылась. В противном случае, возвращается True.

</details>
<details>
<summary> *hasCorrectFormat2* - проверка на корректность множества, полученного после перевода в него строки. </summary>
	
	Функция возращает False, есть полученное множество имеет более одного элемента и при этом содержит в качестве элементов пустую строку или одиночную фигурную скобку. Иначе возвращается True.
	
</details>
<details>
<summary> *strToSet* - перевод строки в множество. </summary>
	
	Если строка не проходит проверку в hasCorrectFormat1, вместо множества функция возвращает строку "Error". Из строки для удобства удаляются все пробелы. После происходит разбитие строки по запятым на список list1. Объявляется список list2 и дополнительная переменная in_set, которая обозначает "состояние записи подсписка". Дальше начинается проход по list1. Если элемент list1 - не множества или множество из одного элемента, оно просто добавляется в list2. Если же по открывающей фигурной скобке в начале строки-элемента list1 определяется начало подмножества, происходит смена значения in_set на True (т.е. происходит вход в "состояние записи подсписка") и объявляется вспомогательная строка a, в которую записываются части подмножества (подсписка). Когда проход по list1 достигает строки с закрывающей фигурной скобке в конце (т.е. конца подмножества), происходит выход из "состояния записи подсписка" и вспомогательная строка добавляется в list2. Если получившийся список list2 не проходит проверку в hasCorrectFormat2, вместо множества функция возвращает строку "Error". Начинается дополнительный обход по list2, и все входящие в него подсписки рекурсивно проверяются на корректность. Если каждый подсписок проходит проверку, подсписок переводится в формат множества, сортируется и возвращается как значение функции.

</details>


Методы в классе *Mnozh*:
	
<details>
<summary> *setToStr* - перевод множества в строку. </summary>
	
	Во вспомогательную строку добавляются поочерёдно открывающая фигурная скобка, само множество, объединённое в строку встроенным методом join, и закрывающая фигурная скобка, и происходит возврат данной строки.

</details>
<details>
<summary> *isSubset* - определение, является ли множество *a* подмножеством множества *sett*. </summary>
	
	Объявляются вспомогательные множества c и d, получаемые переводом соответственно множеств a и sett в строку и обратно. Если получившаяся проверка не выдала ошибки, определяется наличие каждого элемента c в d; в случае успеха выводится True, иначе - False. Если хотя бы одно из множеств не прошло проверку на корректность, вместо True или False метод возвращает строку "Error".

</details>
<details>
<summary> *isElement* - определение, является ли множество *a* подмножеством множества *sett*. </summary>
	
	Объявляются вспомогательные множества c и d, получаемые переводом соответственно множеств a и sett в строку и обратно. Если получившаяся проверка не выдала ошибки, множество c переводится в строку и определяется её наличие в d; в случае успеха выводится True, иначе - False. Если хотя бы одно из множеств не прошло проверку на корректность, вместо True или False метод возвращает строку "Error".

</details>


## Описание кода основной программы
1. Подключается модуль *buraksets.py*.
2. Пользователь вводит файл, из которого необходимо прочитать множества. В файле должны быть через строку записаны два множества в классической записи теории множеств, но пустое множество обозначается двумя последовательно записанными открывающей и закрывающей фигурными скобками. Кроме того, программа принимает не более одного уровня вложенных множеств (т.е. в множестве могут быть подмножества, а у подмножеств своих подмножества быть не могут).
3. Производится открытие файла *file*, название которого было только что введено.
	3.1 При ошибке открытия файла программа выводит предупреждение и завершает свою работу.
4. Производится ввод из *file* двух строк, *string1* и *string2*.
5. Обе строки переводятся при помощи функции *strToSet* в множества *set1* и *set2* соответственно.
	5.1	Программа сообщает, если при переводе одной или двух строк произошла ошибка, и программа переходит на шаг 8.
6. Производится вывод двух множеств, переведённых в строку методом *setToStr* класса *Mnozh*.
7. Программа поочерёдно выводит:
	7.1 Является ли *set1* элементом *set2* (используется метод *isElement* класса *Mnozh*).
	7.2 Является ли *set2* элементом *set1* (используется метод *isElement* класса *Mnozh*).
	7.3 Является ли *set1* подмножеством *set2* (используется метод *isSubset* класса *Mnozh*).
	7.4 Является ли *set2* подмножеством *set1* (используется метод *isSubset* класса *Mnozh*).
8. Закрывается *file*.
		
## Тесты
Файл *buraktests.py* с юнит-тестами, проверяющими работу функций и методов класса *Mnozh* в *buraksets.py* находится в репозитории.

## Вывод
На Python была создана библиотека, переводящая введённую строку в формат множества и обратно, проверяющая строку и получившееся множество на корректность, определяющая, являются ли заданные множества подмножеством или элементом друг друга.